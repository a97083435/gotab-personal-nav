import{u as e,k as a,r as l,i as s,t,e as r,V as o,Q as i,W as n,z as d,X as c,Y as u,aq as m,ar as x,a1 as h,a2 as f,j as p,hY as g,F as j,w as b,B as C,hZ as w,h_ as v,h$ as k,C as y,i0 as F,a4 as I,a5 as S,H as T,a3 as V,D as N,dd as P,L,dh as q,a8 as D,U as z,y as B,G as U,J as W,K as H,dj as A,a0 as E,i1 as O,a9 as R,i2 as _,E as G}from"./main-Bo2fjBi0.js";const{useToken:K}=t,{TextArea:M}=b;function Y(t){const{item:Y}=t,$=e(),J=a(e=>e.appData.listData),Q=a(e=>e.swiper.showSwiper),X=a(e=>e.home.showFreeDrag),[Z,ee]=l.useState(null),[ae]=s(),{token:le}=K(),[se,te]=l.useState(!1),[re,oe]=l.useState("icon"),[ie,ne]=l.useState(Y||{}),de=a(e=>e.user.token),ce=a(e=>e.swiper.activeIndex),ue=a(e=>e.card.defaultCardSize),me=a(e=>e.card.defaultCardShowType),xe=a(e=>e.card.defaultIconPadding),he=a(e=>e.card.addCardDefaultBgColor),fe=a(e=>e.card.addCardDefaultFontColor),pe=J[ce].id,ge=l.useMemo(()=>J?.map(e=>({label:e.label,value:e.id})),[J]),je=l.useCallback(e=>{if(X&&!Q){const a=r.getState().appData.freeDragListData,l=o(a).concat([{id:i(),type:"link",...e}]);$(n(l)),d.success("卡片已添加至自由拖拽区域")}else{const a=r.getState().appData.listData,l=c(o(a),pe,{id:i(),type:"link",...e});$(u(l)),d.success("卡片添加完成")}m.hide(x)},[pe,Z]),be=l.useRef(null);l.useEffect(()=>()=>{be.current&&clearTimeout(be.current),be.current=null},[]);const[Ce,we]=l.useState([]);return l.useEffect(()=>()=>{h()&&f({todo:"getWebsiteInfo",url:"cancel"})},[]),p.jsx("div",{className:"flex flex-wrap gap-3 justify-center",children:p.jsxs("div",{className:"flex-auto max-w-[640px]",children:[p.jsx(g,{showItem:ie}),p.jsxs(j,{id:"add-edit-link-card",form:ae,variant:"filled",autoComplete:"off",labelCol:{flex:"84px"},initialValues:{...Y,link:Y.url,label:Y.title,size:ue||"11",openTarget:"globalSet",showType:me||"icon",backgroundColor:he||"#ffffff",fontColor:fe||"#000000",iconPadding:xe||0},onFinish:e=>{e.icon&&(e.icon=v(e.icon,"https://")),e.link&&(e.link=v(e.link,"https://")),e.internalLink&&(e.internalLink=v(e.internalLink,"http://")),je(e)},onValuesChange:e=>{e.showType&&oe(e.showType),e.backgroundColor&&ae.setFieldValue("fontColor",_(e.backgroundColor)),be.current&&clearTimeout(be.current),be.current=setTimeout(()=>{ne(ae.getFieldsValue())},0)},children:[p.jsxs("div",{className:"flex gap-3 items-end",children:[p.jsx(j.Item,{className:"flex-1",label:"卡片链接",name:"link",required:!0,rules:[{required:!0,message:"请输入卡片链接"}],children:p.jsx(b,{maxLength:512,placeholder:"请输入卡片链接，默认安全链接（https://）",allowClear:!0,addonAfter:p.jsx(C,{onClick:async()=>{const e=ae.getFieldValue("link");if(!e)return void d.error("请输入卡片链接");const a=v(e,"https://");if(!k(a))return void d.error("请输入正确的卡片链接");const l=r.getState().home.getWebsiteInfoBy;if(h()&&"local"===l){y(1,we);const e=await f({todo:"getWebsiteInfo",url:a}),l=(new DOMParser).parseFromString(e,"text/html"),s=F(l,a);if(I(e)&&S(e)||""===s.title)return d.error("获取网站信息失败"),void T(1,we);let t="",r=!1;if(s.icon){const e=await f({todo:"uploadIcon",icon:s.icon,baseUrl:V()});!e||I(e)&&S(e)?(r=!0,d.error("网站图标获取失败")):200===e.code&&e.data&&(t=e.data.faviconUrl)}ae.setFieldsValue({label:s.title,icon:t,backgroundColor:he||"#ffffff",fontColor:fe||"#000000",description:s.description,iconPadding:xe||6}),ae.validateFields({dirty:!0}),ne(ae.getFieldsValue()),r||d.success("获取网站信息完成"),T(1,we)}else y(1,we),N({url:G.getWebsiteInfo,data:{url:a}}).then(e=>{200===e?.code&&e.data&&(ae.setFieldValue("label",e.data.title||""),ae.setFieldValue("icon",e.data.icon||""),ae.setFieldValue("backgroundColor",e.data.backgroundColor||"#ffffff"),ae.setFieldValue("fontColor",e.data.fontColor||"#000000"),ae.setFieldValue("description",e.data.description||""),e.data.backgroundColor&&e.data.fontColor||ae.setFieldValue("iconPadding",6),ae.validateFields({dirty:!0}),setTimeout(()=>{ne(ae.getFieldsValue())},0))}).finally(()=>{T(1,we)})},loading:Ce[1],type:"text",className:"rounded-none",children:"获取信息",icon:p.jsx(w,{})})})}),p.jsx("div",{className:"flex items-center h-8 mb-6",children:p.jsx(P,{checked:se,checkedChildren:"内网",onChange:e=>{te(e)},unCheckedChildren:"常规"})})]}),p.jsx(j.Item,{label:"内网链接",required:!0,rules:[{required:se,message:"请输入内网链接"}],name:"internalLink",style:{display:se?"":"none"},children:p.jsx(b,{placeholder:"请输入内网链接，默认普通链接（http://）",allowClear:!0,maxLength:512})}),p.jsxs("div",{className:"flex flex-wrap *:flex-1 gap-x-3",children:[p.jsx(j.Item,{label:"卡片名称",name:"label",required:!0,rules:[{validator:(e,a)=>a&&""!==a?a.length>100?Promise.reject("卡片名称不能超过100个字符"):Promise.resolve():Promise.reject("请输入卡片名称")}],children:p.jsx(b,{placeholder:"请输入卡片名称",allowClear:!0,maxLength:100})}),"icon-h"===re||"icon-v"===re?p.jsx(j.Item,{label:"卡片内标题",name:"innerlabel",rules:[{validator:(e,a)=>a&&a.length>100?Promise.reject("卡片内标题不能超过20个字符"):Promise.resolve()}],children:p.jsx(b,{placeholder:"若填写，将替换卡片名称显示",allowClear:!0,maxLength:20})}):null]}),p.jsx(j.Item,{label:"卡片大小",name:"size",className:"*:max-w-64",required:!0,rules:[{required:!0,message:"请选择卡片大小"}],children:p.jsx(L,{placeholder:"请选择卡片大小",options:q})}),p.jsx(j.Item,{label:"展示样式",name:"showType",required:!0,rules:[{required:!0,message:"请选择展示样式"}],children:p.jsxs(D.Group,{className:"ml-3",children:[p.jsx(D,{value:"icon",children:"纯图"}),p.jsx(D,{value:"text",children:"文本"}),p.jsx(D,{value:"icon-h",children:"横版"}),p.jsx(D,{value:"icon-v",children:"竖版"})]})}),p.jsx(j.Item,{label:"图标地址",name:"icon",required:!0,style:{display:"text"!==re?"":"none"},rules:[{validator:(e,a)=>"text"===re||a&&""!==a?a&&a.length>200?Promise.reject("网站图标不能超过200个字符"):Promise.resolve():Promise.reject("请获取或上传网站图标")}],children:p.jsx(b,{addonBefore:p.jsx(W,{title:"设为本地默认",destroyOnHidden:!0,children:p.jsx(C,{type:"text",className:"rounded-none",icon:p.jsx(H,{}),onClick:()=>{ae.setFieldValue("icon","/default/IeOutlined"),setTimeout(()=>{ne(ae.getFieldsValue())},0)}})}),placeholder:"请输入图标地址，默认安全链接（https://）",allowClear:!0,addonAfter:p.jsx(z,{disabled:!de,accept:".png, .jpg, .jpeg, .svg, .webp, .ico",showUploadList:!1,beforeUpload:e=>e.size>204800?(d.error("图标大小不能超过200KB！"),!1):(y(0,we),N({url:G.uploadIcon,token:de,data:U({file:e})}).then(e=>{if(200===e?.code&&e.data){ae.setFieldValue("icon",e.data.icon_url),ae.validateFields({dirty:!0});const a=ae.getFieldsValue();ne({...ie,...a,icon:e.data.icon_url})}}).finally(()=>{T(0,we)}),!1),children:p.jsx(C,{onClick:()=>{de||d.error("请您先完成登录/注册")},disabled:Ce[0],loading:Ce[0],type:"text",className:"rounded-none",children:"上传",icon:p.jsx(B,{})})})})}),p.jsx(j.Item,{label:"文本内容",name:"text",style:{display:"text"!==re?"none":""},rules:[{validator:(e,a)=>a&&a.length>100?Promise.reject("文本内容不能超过20个字符"):Promise.resolve()}],children:p.jsx(b,{placeholder:"请输入文本内容",maxLength:20,allowClear:!0})}),p.jsxs("div",{className:"flex flex-wrap *:flex-1 gap-x-3",children:[p.jsx(j.Item,{label:"背景颜色",name:"backgroundColor",normalize:e=>e?.cleared?"":e.toHexString(),children:p.jsx(A,{showText:!0})}),p.jsx(j.Item,{label:"文字颜色",normalize:e=>e?.cleared?"":e.toHexString(),name:"fontColor",children:p.jsx(A,{showText:!0})})]}),p.jsx(E,{className:"mt-0 text-sm",children:"更多配置"}),p.jsxs("div",{className:"flex flex-wrap *:flex-1 gap-x-3",children:[p.jsx(j.Item,{label:"打开方式",name:"openTarget",required:!0,rules:[{required:!0,message:"请选择打开方式"}],children:p.jsx(L,{options:O,className:"max-w-32"})}),p.jsx(j.Item,{label:"图标内间距",name:"iconPadding",children:p.jsx(R,{min:0,max:48,precision:0,placeholder:"图标内间距"})})]}),p.jsx(j.Item,{className:"mb-16",label:"描述/备注",name:"description",rules:[{validator:(e,a)=>a&&a.length>255?Promise.reject("卡片描述/备注不能超过200个字符"):Promise.resolve()}],children:p.jsx(M,{autoSize:{minRows:2,maxRows:2},placeholder:"请输入卡片描述/备注",allowClear:!0,maxLength:200})}),p.jsxs("div",{className:"flex w-full justify-between flex-row-reverse gap-3 px-4 py-3 absolute left-0 bottom-0 z-10",style:{backgroundColor:le.colorBgContainer,borderTop:`1px solid ${le.colorBorderSecondary}`},children:[p.jsx(C,{onClick:()=>{ee("save"),setTimeout(()=>{ae.submit()},0)},type:"primary",children:"导入书签"}),Q||!Q&&!X?p.jsx(L,{options:ge,value:pe,placeholder:"目标分组",className:"w-32 max-w-full",onChange:e=>{const a=J?.findIndex(a=>a.id===e),l=r.getState().stateUtils.mySwiper,s=r.getState().swiper.loop;-1!==a&&l&&(s?l.slideToLoop(a):l.slideTo(a))}}):null]})]})]})})}export{Y as default};
